@using MedicalAppointmentsSystem.Areas.User.Models.ViewModels
@model List<UserAppointmentRequestVM>
@{
    ViewData["Title"] = "My Appointment Requests";
    Layout = "_Layout";
}

<div class="container mt-5">
    <h1 class="text-primary mb-4"><i class="fas fa-calendar-check me-2"></i>@ViewData["Title"]</h1>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-list me-2"></i>Request History</h5>
        </div>
        <div class="card-body">
            @if (Model.Any())
            {
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead>
                            <tr>
                                <th><i class="fas fa-clinic-medical me-1"></i> Clinic</th>
                                <th><i class="fas fa-user-md me-1"></i> Doctor</th>
                                <th><i class="fas fa-calendar-day me-1"></i> Preferred Date</th>
                                <th><i class="fas fa-clock me-1"></i> Requested At</th>
                                <th><i class="fas fa-info-circle me-1"></i> Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var request in Model)
                            {
                                <tr>
                                    <td>@request.ClinicName</td>
                                    <td>Dr. @request.DoctorName</td>
                                    <td>@request.PreferredDate.ToString("MMMM dd, yyyy")</td>
                                    <td>@request.RequestedAt.ToString("g")</td>
                                    <td>
                                        @if (request.RequestStatus == "Approved")
                                        {
                                            <span class="badge bg-success"><i class="fas fa-check-circle me-1"></i> @request.RequestStatus</span>
                                        }
                                        else if (request.RequestStatus == "Rejected")
                                        {
                                            <span class="badge bg-danger"><i class="fas fa-times-circle me-1"></i> @request.RequestStatus</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-warning text-dark"><i class="fas fa-hourglass-half me-1"></i> @request.RequestStatus</span>
                                        }
                                    </td>
                                   
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="alert alert-info">
                    <h5 class="alert-heading"><i class="fas fa-info-circle me-2"></i>No Appointment Requests Found</h5>
                    <p class="mb-0">You haven't made any appointment requests yet.</p>
                    <a asp-action="Index" asp-controller="Home" class="btn btn-primary mt-2">
                        <i class="fas fa-search me-1"></i> Find Clinics
                    </a>
                </div>
            }
        </div>
    </div>
</div>

<style>
    .table {
        border-radius: 10px;
        overflow: hidden;
    }

        .table thead th {
            background-color: #f8f9fa;
            border-bottom: 2px solid var(--medical-primary);
            color: var(--medical-primary);
            white-space: nowrap;
        }

    .table-hover tbody tr:hover {
        background-color: rgba(13, 110, 253, 0.05);
    }

    .badge {
        padding: 0.5em 0.75em;
        font-weight: 500;
        white-space: nowrap;
    }

    .card {
        border-radius: 10px;
        border: none;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }

    .card-header {
        border-radius: 10px 10px 0 0 !important;
    }

    .align-middle td {
        vertical-align: middle;
    }
</style>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true
        });

        @if (TempData["Success"] != null)
        {
            <text>
                    Toast.fire({
                        icon: 'success',
                        title: '@TempData["Success"]'
                    });
            </text>
        }

        @if (TempData["Error"] != null)
        {
            <text>
                    Toast.fire({
                        icon: 'error',
                        title: '@TempData["Error"]'
                    });
            </text>
        }
    </script>
}