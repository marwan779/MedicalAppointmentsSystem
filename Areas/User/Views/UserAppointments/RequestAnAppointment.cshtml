@using MedicalAppointmentsSystem.Areas.User.Models.ViewModels
@model SetUserAppointmentRequestVM
@{
	ViewData["Title"] = "Request Appointment";
	Layout = "_Layout";
}

<div class="container mt-5">
	<div class="row justify-content-center">
		<div class="col-lg-8">
			<div class="card shadow-sm">
				<div class="card-header bg-primary text-white">
					<h3 class="mb-0"><i class="fas fa-calendar-plus me-2"></i>@ViewData["Title"]</h3>
				</div>
				<div class="card-body">
					@if (TempData["Error"] != null)
					{
						<div class="alert alert-danger alert-dismissible fade show" role="alert">
							@TempData["Error"]
							<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
						</div>
					}

					<form asp-action="RequestAnAppointment" method="post" enctype="multipart/form-data">
						<input type="hidden" asp-for="ClinicId" />
						<input type="hidden" asp-for="DoctorId" />

						<div class="row mb-4">
							<div class="col-md-6">
								<div class="card h-100 border-primary">
									<div class="card-body">
										<h5 class="card-title text-primary"><i class="fas fa-calendar-alt me-2"></i>Appointment Details</h5>

										<div class="mb-3">
											<label asp-for="PreferredDate" class="form-label">Preferred Date*</label>
											<input asp-for="PreferredDate" type="date"
												   class="form-control"
												   min="@DateTime.Now.ToString("yyyy-MM-dd")"
												   max="@DateTime.Now.AddMonths(3).ToString("yyyy-MM-dd")" />
											<span asp-validation-for="PreferredDate" class="text-danger"></span>
										</div>

										<div class="mb-3">
											<label asp-for="Document" class="form-label">Medical Documents</label>
											<div class="input-group">
												<input asp-for="Document" type="file" class="form-control" accept=".pdf" />
												<button class="btn btn-outline-secondary" type="button" id="clearFile">
													<i class="fas fa-times"></i>
												</button>
											</div>
											<small class="text-muted">Upload any relevant medical reports (PDF only, max 5MB)</small>
										</div>
									</div>
								</div>
							</div>

							<div class="col-md-6">
								<div class="card h-100 border-primary">
									<div class="card-body">
										<h5 class="card-title text-primary"><i class="fas fa-file-medical me-2"></i>Medical Information</h5>

										<div class="mb-3">
											<label asp-for="ComplainsAbout" class="form-label">Symptoms/Reason for Visit*</label>
											<textarea asp-for="ComplainsAbout" class="form-control" rows="4"
													  placeholder="Please describe your symptoms or reason for the appointment"></textarea>
											<span asp-validation-for="ComplainsAbout" class="text-danger"></span>
										</div>

										<div class="mb-3">
											<label asp-for="ChronicDiseases" class="form-label">Existing Medical Conditions</label>
											<textarea asp-for="ChronicDiseases" class="form-control" rows="2"
													  placeholder="List any chronic conditions or allergies"></textarea>
 										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="d-grid gap-2 d-md-flex justify-content-md-end">
							<a asp-action="Index" class="btn btn-outline-secondary me-md-2">
								<i class="fas fa-arrow-left me-1"></i> Cancel
							</a>
							<button type="submit" class="btn btn-primary" asp-route-clinicId="@ViewBag.ClinicId">
								<i class="fas fa-paper-plane me-1"></i> Submit Request
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>

<style>
	.card {
		border-radius: 10px;
		transition: transform 0.3s ease;
	}

		.card:hover {
			transform: translateY(-3px);
			box-shadow: 0 5px 15px rgba(0,0,0,0.1);
		}

	.card-header {
		border-radius: 10px 10px 0 0 !important;
	}

	.border-primary {
		border-left: 4px solid var(--medical-primary) !important;
	}

	textarea {
		min-height: 100px;
		resize: vertical;
	}

	.form-control:focus {
		border-color: var(--medical-primary);
		box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
	}

	#clearFile {
		border-color: #ced4da;
		border-left: 0;
	}
</style>

@section Scripts {
	<partial name="_ValidationScriptsPartial" />
	<script>
		document.addEventListener('DOMContentLoaded', function() {
			// Set minimum date (today) and maximum date (3 months from now)
			const today = new Date().toISOString().split('T')[0];
			document.getElementById('PreferredDate').min = today;

			// File validation
			document.getElementById('Document').addEventListener('change', function(e) {
				const file = e.target.files[0];
				if (file) {
					if (file.size > 5 * 1024 * 1024) { // 5MB
						alert('File size exceeds 5MB limit');
						e.target.value = '';
					} else if (file.type !== 'application/pdf') {
						alert('Only PDF files are allowed');
						e.target.value = '';
					}
				}
			});

			// Clear file input
			document.getElementById('clearFile').addEventListener('click', function() {
				document.getElementById('Document').value = '';
			});
		});
	</script>
}