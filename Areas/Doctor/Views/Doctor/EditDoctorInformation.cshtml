@using MedicalAppointmentsSystem.Models.ViewModels.Doctor
@model EditDoctorInformationVM
@{
    ViewData["Title"] = "Edit Doctor Profile";
    Layout = "_Layout";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg appointment-card">
                <div class="card-header" style="background-color: var(--medical-primary);">
                    <h1 class="text-center text-white"><i class="fas fa-user-edit me-2"></i>@ViewData["Title"]</h1>
                </div>
                <div class="card-body">
                    <form id="doctorInfoForm" method="post" enctype="multipart/form-data" asp-controller="Doctor" asp-action="EditDoctorInformation">
                        @Html.AntiForgeryToken()
                        <h2 class="h4 mb-4" style="color: var(--medical-primary);">Professional Information</h2>
                        <hr class="my-3" />

                       @*  <div class="alert alert-info mb-4">
                            <i class="fas fa-info-circle me-2"></i>You're editing the profile of <strong>@Model.DoctorName</strong>
                        </div>*@

                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="LicenseNumber" class="form-label">Medical License Number</label>
                                    <input asp-for="LicenseNumber" class="form-control" placeholder="Enter license number" />
                                    <span asp-validation-for="LicenseNumber" class="text-danger small"></span>
                                </div>

                                <div class="mb-3">
                                    <label asp-for="YearsExperience" class="form-label">Years of Experience</label>
                                    <input asp-for="YearsExperience" class="form-control" placeholder="Enter years of practice" />
                                    <span asp-validation-for="YearsExperience" class="text-danger small"></span>
                                </div>

                                <div class="mb-3">
                                    <label asp-for="MedicalSchool" class="form-label">Medical School</label>
                                    <input asp-for="MedicalSchool" class="form-control" placeholder="Where did you study?" />
                                    <span asp-validation-for="MedicalSchool" class="text-danger small"></span>
                                </div>

                                <div class="mb-3">
                                    <label asp-for="HospitalAffiliation" class="form-label">Hospital:</label>
                                    <input asp-for="HospitalAffiliation" class="form-control" placeholder="Current workplace" />
                                    <span asp-validation-for="HospitalAffiliation" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="Specialization" class="form-label">Specialization</label>
                                    <select asp-for="Specialization" asp-items="@Model.SpecializationList" class="form-select">
                                        <option selected disabled>@Model.Specialization</option>
                                    </select>
                                    <span asp-validation-for="Specialization" class="text-danger small"></span>
                                </div>

                                <div class="mb-3">
                                    <label asp-for="GraduationYear" class="form-label">Graduation Year</label>
                                    <input asp-for="GraduationYear" class="form-control" placeholder="Year you graduated" />
                                    <span asp-validation-for="GraduationYear" class="text-danger small"></span>
                                </div>

                                <div class="mb-3">
                                    <label asp-for="Department" class="form-label">Department</label>
                                    <input asp-for="Department" class="form-control" placeholder="Your department" />
                                    <span asp-validation-for="Department" class="text-danger small"></span>
                                </div>

                                <div class="mb-3">
                                    <label asp-for="Position" class="form-label">Position</label>
                                    <input asp-for="Position" class="form-control" placeholder="Your position/title" />
                                    <span asp-validation-for="Position" class="text-danger small"></span>
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label asp-for="Bio" class="form-label">Professional Bio</label>
                            <textarea asp-for="Bio" class="form-control" rows="4" placeholder="Tell patients about your background and approach (max 500 chars)"></textarea>
                            <span asp-validation-for="Bio" class="text-danger small"></span>
                        </div>

                        <div class="mb-4">
                            <label asp-for="EmergencyPhone" class="form-label">Emergency Contact</label>
                            <input asp-for="EmergencyPhone" class="form-control" placeholder="Emergency phone number" />
                            <span asp-validation-for="EmergencyPhone" class="text-danger small"></span>
                        </div>

                        <h3 class="h5 mt-5 mb-3" style="color: var(--medical-primary);">Document Management</h3>
                        <hr class="my-3" />

                        <div class="row g-3 mb-4">
                            <div class="col-md-4">
                                <div class="border p-3 rounded">
                                    <label class="form-label">Current License</label>
                                    @if (!string.IsNullOrEmpty(Model.LicenseImagePath))
                                    {
                                        <div class="mb-2">
                                            <a href="@Model.LicenseImagePath" target="_blank" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-eye me-1"></i>View Current
                                            </a>
                                        </div>
                                    }

                                    <input type="hidden" asp-for="LicenseImagePath" />

                                    <label asp-for="LicenseImage" class="form-label">Update License</label>
                                    <input asp-for="LicenseImage" class="form-control" type="file" />
                                    <small class="text-muted">Leave blank to keep current</small>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="border p-3 rounded">
                                    <label class="form-label">Current ID Proof</label>
                                    @if (!string.IsNullOrEmpty(Model.IdProofPath))
                                    {
                                        <div class="mb-2">
                                            <a href="@Model.IdProofPath" target="_blank" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-eye me-1"></i>View Current
                                            </a>
                                        </div>
                                    }

                                    <input type="hidden" asp-for="IdProofPath" />


                                    <label asp-for="IdProof" class="form-label">Update ID Proof</label>
                                    <input asp-for="IdProof" class="form-control" type="file" />
                                    <small class="text-muted">Leave blank to keep current</small>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="border p-3 rounded">
                                    <label class="form-label">Current Photo</label>
                                    @if (!string.IsNullOrEmpty(Model.PhotoPath))
                                    {
                                        <div class="mb-2">
                                            <a href="@Model.PhotoPath" target="_blank" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-eye me-1"></i>View Current
                                            </a>
                                        </div>
                                    }

                                    <input type="hidden" asp-for="PhotoPath" />

                                    <label asp-for="Photo" class="form-label">Update Photo</label>
                                    <input asp-for="Photo" class="form-control" type="file" />
                                    <small class="text-muted">Leave blank to keep current</small>
                                </div>
                            </div>
                        </div>

                        <div class="d-grid gap-2 mt-5">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-save me-2"></i>Update Profile
                            </button>
                            <a asp-controller="Doctor" asp-action="Index" class="btn btn-outline-secondary btn-lg mt-2">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                        </div>

                        <div class="mt-4 pt-3 border-top">
                            <p class="text-muted small">
                                <i class="fas fa-shield-alt me-2"></i>All information is securely stored and encrypted.
                            </p>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end', // top-right
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true
        });

        @if (TempData["Success"] != null)
        {
            <text>
                    Toast.fire({
                        icon: 'success',
                        title: '@TempData["Success"]'
                    });
            </text>
        }

        @if (TempData["Error"] != null)
        {
            <text>
                    Toast.fire({
                        icon: 'error',
                        title: '@TempData["Error"]'
                    });
            </text>
        }

        @if (TempData["Warning"] != null)
        {
            <text>
                    Toast.fire({
                        icon: 'warning',
                        title: '@TempData["Warning"]'
                    });
            </text>
        }
    </script>
}
